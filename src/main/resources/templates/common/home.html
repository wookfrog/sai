<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SAI ì»¤í”Œ í™ˆ</title>

  <style>
    :root{
      /* ìš°ë¦¬ í…Œë§ˆ */
      --grad-start:#ff9a9e; --grad-mid:#fecfef; --grad-end:#fbc2eb;
      --violet:#7b4fa8; --text:#2b2b2b; --sub:#8b8f98; --border:#eceff3; --white:#fff;
      --card-bg:rgba(255,255,255,.78); --card-stroke:rgba(255,255,255,.65);
      --shadow:0 18px 50px rgba(121,58,120,.15);
    }

    html,body{height:100%;margin:0;color:var(--text);font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;}
    /* ë°°ê²½(ë¡œê·¸ì¸/ìŠ¤í”Œë˜ì‹œì™€ ê°™ì€ ê²°) */
    .app-bg{
      min-height:100dvh;
      background:
        radial-gradient(1200px 900px at 15% 8%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(900px 700px at 88% 90%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(160deg,var(--grad-start),var(--grad-mid) 45%,var(--grad-end));
      display:flex;justify-content:center;
      padding-bottom:calc(68px + env(safe-area-inset-bottom,0px)); /* íƒ­ë°” ìë¦¬ */
    }

    /* ëª¨ë°”ì¼ ìº”ë²„ìŠ¤ */
    .app{
      width:min(480px, 100vw);
      display:flex; flex-direction:column;
    }

    /* í—¤ë” (ê¸€ë˜ìŠ¤+ì•Œë¦¼) */
    .header{
      position:sticky; top:env(safe-area-inset-top,0px);
      padding:16px 18px; z-index:5;
      display:flex; align-items:center; justify-content:center; gap:8px;
      color:#fff; font-weight:900; letter-spacing:.4px; font-size:22px;
    }
    .header .right{
      position:absolute; right:12px; top:12px; display:flex; align-items:center; gap:10px;
    }
    .bell{
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px; border-radius:50%;
      background:rgba(255,255,255,.25); backdrop-filter:blur(6px);
      color:#fff; text-decoration:none;
      border:1px solid rgba(255,255,255,.5);
    }
    .badge{
      position:absolute; top:-4px; right:-4px;
      background:#ff3b57; color:#fff; border-radius:999px;
      font-size:10px; padding:2px 6px; border:2px solid rgba(255,255,255,.9);
    }

    /* ë©”ì¸ ì¹´ë“œ(ê¸€ë˜ìŠ¤) */
    .card{
      margin:10px 14px 0; padding:18px 14px;
      background:var(--card-bg); border:1px solid var(--card-stroke);
      border-radius:22px; box-shadow:var(--shadow);
    }

    /* ê¸°ëŠ¥ íƒ€ì¼ */
    .feature-grid{
      display:grid; grid-template-columns:repeat(3,1fr); gap:12px;
    }
    .tile{
      height:92px; border-radius:18px; background:#fff; border:1px solid var(--border);
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px;
      text-decoration:none; color:#333; font-weight:800; font-size:14px;
      box-shadow:0 8px 20px rgba(0,0,0,.06);
    }
    .tile .ico{font-size:22px;}

    /* íˆì–´ë¡œ(ì´ë¯¸ì§€ + ë¬¸êµ¬) */
    .hero{
      margin:16px 14px 0; padding:16px; border-radius:22px;
      background:#fff6fb; border:1px solid var(--border); box-shadow:var(--shadow);
      display:flex; flex-direction:column; align-items:center; text-align:center;
    }
    .hero .imgwrap{
      width:100%; max-width:360px; border-radius:16px; overflow:hidden;
      background:#fff; box-shadow:0 10px 24px rgba(0,0,0,.08); margin-bottom:12px;
    }
    .hero img{display:block; width:100%; height:auto;}
    .hero p{margin:6px 0 0; color:#5e6470; font-weight:700;}

    /* í•˜ë‹¨ íƒ­ë°” */
    .tabbar{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:env(safe-area-inset-bottom,0px);
      width:min(480px,100vw); height:64px;
      background:rgba(255,255,255,.85); backdrop-filter:blur(10px);
      border-top:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-around;
      box-shadow:0 -10px 24px rgba(0,0,0,.08);
    }
    .tab{
      flex:1; display:flex; flex-direction:column; align-items:center; gap:4px;
      text-decoration:none; color:#7b7f87; font-size:11px; font-weight:700;
    }
    .tab .t-ico{font-size:20px; line-height:1;}
    .tab.active{ color:var(--violet); }
  </style>
</head>

<body>
  <div class="app-bg">
    <div class="app">

      <!-- Header -->
      <header class="header">
        SAI ì»¤í”Œ í™ˆ
        <div class="right">
          <a th:href="@{/notifications/list}" class="bell" aria-label="ì•Œë¦¼">
            ğŸ”” <span id="noti-badge" class="badge">0</span>
          </a>
        </div>
      </header>

      <!-- ê¸°ëŠ¥ íƒ€ì¼ -->
      <section class="card">
        <div class="feature-grid">
          <a th:href="@{/question}" class="tile"><div class="ico">ğŸ“</div>ì˜¤ëŠ˜ì˜ ë¬¸ë‹µ</a>
          <a th:href="@{/diary}"   class="tile"><div class="ico">ğŸ“”</div>ë‹¤ì´ì–´ë¦¬</a>
          <a th:href="@{/bucket}"  class="tile"><div class="ico">ğŸ¯</div>ë²„í‚·ë¦¬ìŠ¤íŠ¸</a>
        </div>
      </section>

      <!-- íˆì–´ë¡œ -->
      <section class="hero">
        <div class="imgwrap">
          <!-- ì„ì‹œ ì´ë¯¸ì§€: í•„ìš”ì‹œ êµì²´ -->
          <img src="https://file.miricanvas.com/template_thumb/2025/02/12/16/30/k31jmfoct1o60ops/thumb.webp?size=800"
               alt="SAI ìºë¦­í„°">
        </div>
        <p>ì˜¤ëŠ˜ì˜ ë¯¸ì…˜ ì™„ë£Œí•˜ê³  ì‚¬ë‘ì„ ì¶©ì „í•´ë³¼ê¹Œìš”?</p>
      </section>

      <!-- (optional) ì»¤í”Œ ë§¤ì¹­ ì•ˆë‚´ ì¹´ë“œ -->
      <section class="card" th:if="${notMatched}">
        <p style="margin:0 0 10px; font-weight:800;">ì•„ì§ ì»¤í”Œì´ ë§¤ì¹­ë˜ì§€ ì•Šì•˜ì–´ìš”!</p>
        <div style="display:flex; gap:10px;">
          <a th:href="@{/invite/code}" class="tile" style="flex:1; height:48px;">ì´ˆëŒ€ì½”ë“œ</a>
          <a th:href="@{/invite}" class="tile" style="flex:1; height:48px;">ì»¤í”Œ ë§¤ì¹­</a>
        </div>
      </section>

    </div>
  </div>

  <!-- í•˜ë‹¨ íƒ­ë°” -->
  <nav class="tabbar">
    <a th:href="@{/schedule}" class="tab"><div class="t-ico">ğŸ“…</div>ìº˜ë¦°ë”</a>
    <a th:href="@{/chat/room}" class="tab" target="_blank"><div class="t-ico">ğŸ’¬</div>ì±„íŒ…</a>
    <a th:href="@{'/video/test'(roomId=${roomId}, userId=${userId})}" class="tab" target="_blank"><div class="t-ico">ğŸ¥</div>ì˜ìƒí†µí™”</a>
    <a th:href="@{/decorate}" class="tab"><div class="t-ico">ğŸ </div>í™ˆ ê¾¸ë¯¸ê¸°</a>
    <a th:href="@{/setting}" class="tab active"><div class="t-ico">âš™ï¸</div>ì„¤ì •</a>
  </nav>

  <!-- ì•Œë¦¼ ë±ƒì§€/ì‹¤ì‹œê°„ êµ¬ë… -->
  <script>
    async function updateBadge(){
      try{
        const res = await fetch('/api/notifications');
        const data = await res.json();
        const unread = (data||[]).filter(n => !n.isRead).length;
        const el = document.getElementById('noti-badge');
        if(el) el.textContent = unread;
      }catch(e){ console.error('ì•Œë¦¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', e); }
    }
    window.addEventListener('DOMContentLoaded', updateBadge);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  <script>
    let stompClient;
    function connectStomp(){
      const sock = new SockJS("/ws-chat");
      stompClient = Stomp.over(sock);
      stompClient.connect({}, () => {
        stompClient.subscribe('/user/queue/notifications', () => {
          const badge = document.getElementById('noti-badge');
          const cur = parseInt(badge.textContent || '0', 10);
          badge.textContent = cur + 1;
        });
      });
    }
    window.addEventListener('DOMContentLoaded', connectStomp);
  </script>
</body>
</html>
